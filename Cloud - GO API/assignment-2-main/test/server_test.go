package test

import (
	"assignment-2/handler"
	"assignment-2/helper"
	"bytes"
	"encoding/json"
	"net/http"
	"net/http/httptest"
	"reflect"
	"regexp"
	"testing"
)

const baseURL = "http://localhost:8080"

func testHandlerResponse(t *testing.T, url string, expected string, histHandler http.HandlerFunc) bool {
	// Create a new request with the given URL
	req, err := http.NewRequest("GET", url, nil)
	if err != nil {
		t.Fatal(err)
	}

	// Create a new ResponseRecorder to record the response
	rr := httptest.NewRecorder()

	// Call the handler function with the request and response recorder
	testHandler := histHandler
	testHandler.ServeHTTP(rr, req)

	// Check the response status code
	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v", status, http.StatusOK)
		return false
	}

	// Check the response body
	if rr.Body.String() != expected {
		t.Errorf("handler returned unexpected body: got %v want %v", rr.Body.String(), expected)
		return false
	}

	return true
}

// testing all type of Url with the history handler
func TestHistoryHandler(t *testing.T) {
	var expected = `[{"Name":"United States","Iso":"USA","Borders":["CAN","MEX"],"Percentage":0,"Year":1969}]`
	var testUrl = "/energy/v1/renewables/history/USA?begin=1969&end=1969"
	var thisHandler = handler.HistoryHandler
	// Test the /energy/v1/renewables/history/USA endpoint where its the year 1969
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Norway","Iso":"NOR","Borders":["FIN","SWE","RUS"],"Percentage":98.571,"Year":2020},{"Name":"Norway","Iso":"NOR","Borders":["FIN","SWE","RUS"],"Percentage":99.544,"Year":2021}]`
	testUrl = "/energy/v1/renewables/history/Nor?begin=2020"
	// Test the /energy/v1/renewables/history/Nor?begin=2020 endpoint where its the year 2020 or more
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1900},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1901},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1902},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1903},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1904},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1905},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":0,"Year":1906}]`
	testUrl = "/energy/v1/renewables/history/swe?end=1906"
	// Test the /energy/v1/renewables/history/swe?begin=2020 endpoint where its the year 1906 or less
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":0,"Year":1985},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":0,"Year":1986},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":0,"Year":1987},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":0,"Year":1988},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":0,"Year":1989},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":15.423,"Year":1990},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":15.743,"Year":1991},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":17.121,"Year":1992},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.226,"Year":1993},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":20.092,"Year":1994},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":20.501,"Year":1995},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.221,"Year":1996},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.881,"Year":1997},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.169,"Year":1998},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.972,"Year":1999},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.702,"Year":2000},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":20.647,"Year":2001},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.194,"Year":2002},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.006,"Year":2003},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.933,"Year":2004},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.242,"Year":2005},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.494,"Year":2006},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.524,"Year":2007},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":16.822,"Year":2008},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.623,"Year":2009},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":17.033,"Year":2010},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":16.698,"Year":2011},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":16.443,"Year":2012},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.124,"Year":2013},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":17.502,"Year":2014},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":16.754,"Year":2015},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":17.995,"Year":2016},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":17.996,"Year":2017},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.423,"Year":2018},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":18.546,"Year":2019},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":20.743,"Year":2020},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.959,"Year":2021}]`
	testUrl = "/energy/v1/renewables/history/rus"
	// Test the /energy/v1/renewables/history/rus endpoint where it gets data from each year about russia
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Afghanistan","Iso":"AFG","Percentage":14.267713114754098},{"Name":"Albania","Iso":"ALB","Percentage":24.929611570247932},{"Name":"Algeria","Iso":"DZA","Percentage":0.3331803278688526},{"Name":"American Samoa","Iso":"ASM","Percentage":0},{"Name":"Angola","Iso":"AGO","Percentage":12.726811475409836},{"Name":"Antarctica","Iso":"ATA","Percentage":0},{"Name":"Antigua and Barbuda","Iso":"ATG","Percentage":0.5668095238095238},{"Name":"Argentina","Iso":"ARG","Percentage":9.77543442622951},{"Name":"Armenia","Iso":"ARM","Percentage":22.78953333333334},{"Name":"Aruba","Iso":"ABW","Percentage":5.417888888888889},{"Name":"Australia","Iso":"AUS","Percentage":3.5771393442622945},{"Name":"Austria","Iso":"AUT","Percentage":22.127105691056908},{"Name":"Azerbaijan","Iso":"AZE","Percentage":8.350702702702705},{"Name":"Bahamas","Iso":"BHS","Percentage":0},{"Name":"Bahrain","Iso":"BHR","Percentage":0.0023032786885245904},{"Name":"Bangladesh","Iso":"BGD","Percentage":1.6479590163934426},{"Name":"Barbados","Iso":"BRB","Percentage":0.23295081967213116},{"Name":"Belarus","Iso":"BLR","Percentage":0.5738918918918918},{"Name":"Belgium","Iso":"BEL","Percentage":2.2619430894308943},{"Name":"Belize","Iso":"BLZ","Percentage":32.70661904761904},{"Name":"Benin","Iso":"BEN","Percentage":0.32178571428571423},{"Name":"Bermuda","Iso":"BMU","Percentage":0},{"Name":"Bhutan","Iso":"BTN","Percentage":52.38095238095238},{"Name":"Bolivia","Iso":"BOL","Percentage":8.982540983606558},{"Name":"Bosnia and Herzegovina","Iso":"BIH","Percentage":29.13843333333334},{"Name":"Botswana","Iso":"BWA","Percentage":0.013163934426229509},{"Name":"Brazil","Iso":"BRA","Percentage":26.623360655737702},{"Name":"British Virgin Islands","Iso":"VGB","Percentage":0},{"Name":"Brunei","Iso":"BRN","Percentage":0},{"Name":"Bulgaria","Iso":"BGR","Percentage":2.949121951219512},{"Name":"Burkina Faso","Iso":"BFA","Percentage":8.336380952380951},{"Name":"Burundi","Iso":"BDI","Percentage":16.010622950819673},{"Name":"Cambodia","Iso":"KHM","Percentage":16.194761904761904},{"Name":"Cameroon","Iso":"CMR","Percentage":13.864499999999998},{"Name":"Canada","Iso":"CAN","Percentage":19.164581967213117},{"Name":"Cape Verde","Iso":"CPV","Percentage":5.844119047619047},{"Name":"Cayman Islands","Iso":"CYM","Percentage":0.2749761904761905},{"Name":"Central African Republic","Iso":"CAF","Percentage":47.00045238095238},{"Name":"Chad","Iso":"TCD","Percentage":2.3965714285714284},{"Name":"Chile","Iso":"CHL","Percentage":15.96229508196721},{"Name":"China","Iso":"CHN","Percentage":6.032098360655736},{"Name":"Colombia","Iso":"COL","Percentage":21.993180327868846},{"Name":"Comoros","Iso":"COM","Percentage":0},{"Name":"Cook Islands","Iso":"COK","Percentage":3.6904761904761907},{"Name":"Costa Rica","Iso":"CRI","Percentage":49.93661904761906},{"Name":"Croatia","Iso":"HRV","Percentage":57.45354545454546},{"Name":"Cuba","Iso":"CUB","Percentage":2.099196721311475},{"Name":"Cyprus","Iso":"CYP","Percentage":2.0027931034482753},{"Name":"Czechia","Iso":"CZE","Percentage":3.866413793103448},{"Name":"DR Congo","Iso":"COD","Percentage":17.981762295081964},{"Name":"Denmark","Iso":"DNK","Percentage":8.85478861788618},{"Name":"Djibouti","Iso":"DJI","Percentage":0},{"Name":"Dominica","Iso":"DMA","Percentage":16.993833333333335},{"Name":"Dominican Republic","Iso":"DOM","Percentage":6.520595238095237},{"Name":"Ecuador","Iso":"ECU","Percentage":21.022499999999994},{"Name":"Egypt","Iso":"EGY","Percentage":4.911991803278689},{"Name":"El Salvador","Iso":"SLV","Percentage":34.43230952380953},{"Name":"Equatorial Guinea","Iso":"GNQ","Percentage":9.479095238095239},{"Name":"Eritrea","Iso":"ERI","Percentage":0.41575},{"Name":"Estonia","Iso":"EST","Percentage":7.456815789473685},{"Name":"Eswatini","Iso":"SWZ","Percentage":16.62349180327869},{"Name":"Ethiopia","Iso":"ETH","Percentage":51.19711904761905},{"Name":"Falkland Islands","Iso":"FLK","Percentage":13.095238095238095},{"Name":"Faroe Islands","Iso":"FRO","Percentage":22.426214285714284},{"Name":"Fiji","Iso":"FJI","Percentage":33.43347619047619},{"Name":"Finland","Iso":"FIN","Percentage":22.359448275862064},{"Name":"France","Iso":"FRA","Percentage":4.7386747967479685},{"Name":"French Guiana","Iso":"GUF","Percentage":21.30895238095238},{"Name":"French Polynesia","Iso":"PYF","Percentage":16.768},{"Name":"Gabon","Iso":"GAB","Percentage":9.02162295081967},{"Name":"Gambia","Iso":"GMB","Percentage":0},{"Name":"Georgia","Iso":"GEO","Percentage":60.59973333333334},{"Name":"Germany","Iso":"DEU","Percentage":4.646268292682927},{"Name":"Ghana","Iso":"GHA","Percentage":11.497532786885246},{"Name":"Gibraltar","Iso":"GIB","Percentage":0},{"Name":"Greece","Iso":"GRC","Percentage":4.698390243902439},{"Name":"Greenland","Iso":"GRL","Percentage":12.113426229508198},{"Name":"Grenada","Iso":"GRD","Percentage":0},{"Name":"Guadeloupe","Iso":"GLP","Percentage":10.558214285714287},{"Name":"Guam","Iso":"GUM","Percentage":0.6140000000000001},{"Name":"Guatemala","Iso":"GTM","Percentage":10.513262295081969},{"Name":"Guinea","Iso":"GIN","Percentage":31.8787380952381},{"Name":"Guinea-Bissau","Iso":"GNB","Percentage":0},{"Name":"Guyana","Iso":"GUY","Percentage":5.883380952380953},{"Name":"Haiti","Iso":"HTI","Percentage":15.024142857142857},{"Name":"Honduras","Iso":"HND","Percentage":24.783023809523808},{"Name":"Hong Kong","Iso":"HKG","Percentage":0.004087719298245614},{"Name":"Hungary","Iso":"HUN","Percentage":1.6243008130081302},{"Name":"Iceland","Iso":"ISL","Percentage":64.88366666666667},{"Name":"India","Iso":"IND","Percentage":5.412204918032787},{"Name":"Indonesia","Iso":"IDN","Percentage":5.570942622950819},{"Name":"Iran","Iso":"IRN","Percentage":2.4843606557377047},{"Name":"Iraq","Iso":"IRQ","Percentage":3.3640983606557375},{"Name":"Ireland","Iso":"IRL","Percentage":4.2968211382113815},{"Name":"Israel","Iso":"ISR","Percentage":0.2588032786885246},{"Name":"Italy","Iso":"ITA","Percentage":7.814544715447155},{"Name":"Ivory Coast","Iso":"CIV","Percentage":5.365590163934424},{"Name":"Jamaica","Iso":"JAM","Percentage":5.41902380952381},{"Name":"Japan","Iso":"JPN","Percentage":3.7713196721311477},{"Name":"Jordan","Iso":"JOR","Percentage":2.2784047619047616},{"Name":"Kazakhstan","Iso":"KAZ","Percentage":9.636837837837838},{"Name":"Kenya","Iso":"KEN","Percentage":39.45076190476191},{"Name":"Kiribati","Iso":"KIR","Percentage":0},{"Name":"Kuwait","Iso":"KWT","Percentage":0.0037131147540983606},{"Name":"Kyrgyzstan","Iso":"KGZ","Percentage":65.41526666666667},{"Name":"Laos","Iso":"LAO","Percentage":46.86007142857143},{"Name":"Latvia","Iso":"LVA","Percentage":54.616289473684205},{"Name":"Lebanon","Iso":"LBN","Percentage":2.7894523809523806},{"Name":"Lesotho","Iso":"LSO","Percentage":52.38095238095238},{"Name":"Liberia","Iso":"LBR","Percentage":2.7895238095238093},{"Name":"Libya","Iso":"LBY","Percentage":0.0031311475409836077},{"Name":"Lithuania","Iso":"LTU","Percentage":19.60292105263158},{"Name":"Luxembourg","Iso":"LUX","Percentage":17.058206896551724},{"Name":"Macau","Iso":"MAC","Percentage":0},{"Name":"Madagascar","Iso":"MDG","Percentage":9.172639344262295},{"Name":"Malawi","Iso":"MWI","Percentage":47.07535714285714},{"Name":"Malaysia","Iso":"MYS","Percentage":3.9776885245901634},{"Name":"Maldives","Iso":"MDV","Percentage":0.7640238095238094},{"Name":"Mali","Iso":"MLI","Percentage":29.914404761904763},{"Name":"Malta","Iso":"MLT","Percentage":2.2188139534883717},{"Name":"Martinique","Iso":"MTQ","Percentage":0},{"Name":"Mauritania","Iso":"MRT","Percentage":9.07247619047619},{"Name":"Mauritius","Iso":"MUS","Percentage":9.131190476190476},{"Name":"Mexico","Iso":"MEX","Percentage":6.186663934426229},{"Name":"Micronesia","Iso":"FSM","Percentage":0},{"Name":"Moldova","Iso":"MDA","Percentage":4.348866666666666},{"Name":"Mongolia","Iso":"MNG","Percentage":0.5054426229508197},{"Name":"Montenegro","Iso":"MNE","Percentage":57.63147058823531},{"Name":"Montserrat","Iso":"MSR","Percentage":0},{"Name":"Morocco","Iso":"MAR","Percentage":3.440098360655737},{"Name":"Mozambique","Iso":"MOZ","Percentage":17.034639344262292},{"Name":"Myanmar","Iso":"MMR","Percentage":10.362122950819671},{"Name":"Namibia","Iso":"NAM","Percentage":66.793875},{"Name":"Nauru","Iso":"NRU","Percentage":0},{"Name":"Nepal","Iso":"NPL","Percentage":17.961852459016395},{"Name":"Netherlands","Iso":"NLD","Percentage":2.571349593495935},{"Name":"New Caledonia","Iso":"NCL","Percentage":9.75114285714286},{"Name":"New Zealand","Iso":"NZL","Percentage":23.00230327868853},{"Name":"Nicaragua","Iso":"NIC","Percentage":21.65995238095238},{"Name":"Niger","Iso":"NER","Percentage":0.4374508196721311},{"Name":"Nigeria","Iso":"NGA","Percentage":5.002959016393444},{"Name":"Niue","Iso":"NIU","Percentage":0},{"Name":"North Korea","Iso":"PRK","Percentage":12.283278688524591},{"Name":"North Macedonia","Iso":"MKD","Percentage":20.01275},{"Name":"Northern Mariana Islands","Iso":"MNP","Percentage":0},{"Name":"Norway","Iso":"NOR","Percentage":29.99816393442622},{"Name":"Oman","Iso":"OMN","Percentage":0.008090163934426228},{"Name":"Pakistan","Iso":"PAK","Percentage":10.325680327868854},{"Name":"Palestine","Iso":"PSE","Percentage":3.83524},{"Name":"Panama","Iso":"PAN","Percentage":33.95607142857143},{"Name":"Papua New Guinea","Iso":"PNG","Percentage":18.847428571428573},{"Name":"Paraguay","Iso":"PRY","Percentage":52.36233333333333},{"Name":"Peru","Iso":"PER","Percentage":21.283811475409838},{"Name":"Philippines","Iso":"PHL","Percentage":10.702549180327864},{"Name":"Poland","Iso":"POL","Percentage":1.811837398373984},{"Name":"Portugal","Iso":"PRT","Percentage":12.62990243902439},{"Name":"Puerto Rico","Iso":"PRI","Percentage":0.6459999999999999},{"Name":"Qatar","Iso":"QAT","Percentage":0.00824590163934426},{"Name":"Republic of the Congo","Iso":"COG","Percentage":11.739516393442624},{"Name":"Romania","Iso":"ROU","Percentage":9.18368292682927},{"Name":"Russia","Iso":"RUS","Percentage":15.885189189189191},{"Name":"Rwanda","Iso":"RWA","Percentage":29.759285714285717},{"Name":"Réunion","Iso":"REU","Percentage":9.740357142857144},{"Name":"Saint Helena, Ascension and Tristan da Cunha","Iso":"SHN","Percentage":0},{"Name":"Saint Kitts and Nevis","Iso":"KNA","Percentage":1.016261904761905},{"Name":"Saint Lucia","Iso":"LCA","Percentage":0},{"Name":"Saint Pierre and Miquelon","Iso":"SPM","Percentage":0},{"Name":"Saint Vincent and the Grenadines","Iso":"VCT","Percentage":9.850952380952382},{"Name":"Samoa","Iso":"WSM","Percentage":22.359119047619046},{"Name":"Saudi Arabia","Iso":"SAU","Percentage":0.00410655737704918},{"Name":"Senegal","Iso":"SEN","Percentage":7.166619047619046},{"Name":"Serbia","Iso":"SRB","Percentage":28.5501875},{"Name":"Seychelles","Iso":"SYC","Percentage":1.0682619047619046},{"Name":"Sierra Leone","Iso":"SLE","Percentage":26.992095238095242},{"Name":"Singapore","Iso":"SGP","Percentage":0.4257368421052632},{"Name":"Slovakia","Iso":"SVK","Percentage":10.783275862068963},{"Name":"Slovenia","Iso":"SVN","Percentage":27.8600606060606},{"Name":"Solomon Islands","Iso":"SLB","Percentage":0},{"Name":"Somalia","Iso":"SOM","Percentage":0.8984285714285715},{"Name":"South Africa","Iso":"ZAF","Percentage":0.4935409836065574},{"Name":"South Korea","Iso":"KOR","Percentage":0.8358688524590164},{"Name":"South Sudan","Iso":"SSD","Percentage":0.7178000000000001},{"Name":"Spain","Iso":"ESP","Percentage":7.746008130081302},{"Name":"Sri Lanka","Iso":"LKA","Percentage":39.159842105263166},{"Name":"Sudan","Iso":"SDN","Percentage":30.443547619047628},{"Name":"Suriname","Iso":"SUR","Percentage":8.966836065573768},{"Name":"Sweden","Iso":"SWE","Percentage":16.370479674796748},{"Name":"Switzerland","Iso":"CHE","Percentage":16.97612295081967},{"Name":"Syria","Iso":"SYR","Percentage":1.5083442622950818},{"Name":"São Tomé and Príncipe","Iso":"STP","Percentage":8.38245238095238},{"Name":"Taiwan","Iso":"TWN","Percentage":1.3164590163934424},{"Name":"Tajikistan","Iso":"TJK","Percentage":71.50196666666666},{"Name":"Tanzania","Iso":"TZA","Percentage":11.099418032786888},{"Name":"Thailand","Iso":"THA","Percentage":2.853778688524589},{"Name":"Timor-Leste","Iso":"TLS","Percentage":0},{"Name":"Togo","Iso":"TGO","Percentage":26.05559523809524},{"Name":"Tonga","Iso":"TON","Percentage":1.7148809523809525},{"Name":"Trinidad and Tobago","Iso":"TTO","Percentage":0.1150491803278689},{"Name":"Tunisia","Iso":"TUN","Percentage":0.38082786885245906},{"Name":"Turkey","Iso":"TUR","Percentage":9.896549180327868},{"Name":"Turkmenistan","Iso":"TKM","Percentage":0.011162162162162164},{"Name":"Turks and Caicos Islands","Iso":"TCA","Percentage":0},{"Name":"Tuvalu","Iso":"TUV","Percentage":0},{"Name":"Uganda","Iso":"UGA","Percentage":45.482190476190475},{"Name":"Ukraine","Iso":"UKR","Percentage":1.777051282051282},{"Name":"United Arab Emirates","Iso":"ARE","Percentage":0.12140163934426229},{"Name":"United Kingdom","Iso":"GBR","Percentage":2.9722213114754097},{"Name":"United States","Iso":"USA","Percentage":3.553967213114754},{"Name":"United States Virgin Islands","Iso":"VIR","Percentage":0.33111904761904765},{"Name":"Uruguay","Iso":"URY","Percentage":43.98285714285715},{"Name":"Uzbekistan","Iso":"UZB","Percentage":11.113108108108108},{"Name":"Vanuatu","Iso":"VUT","Percentage":6.632595238095239},{"Name":"Venezuela","Iso":"VEN","Percentage":20.274557377049188},{"Name":"Vietnam","Iso":"VNM","Percentage":14.148836065573768},{"Name":"Western Sahara","Iso":"ESH","Percentage":0},{"Name":"Yemen","Iso":"YEM","Percentage":1.7005952380952383},{"Name":"Zambia","Iso":"ZMB","Percentage":17.364836065573776},{"Name":"Zimbabwe","Iso":"ZWE","Percentage":10.92404918032787}]`
	testUrl = "/energy/v1/renewables/history/"
	// Test the /energy/v1/renewables/history/rus endpoint where it gets data from each country and their average percentage throughout the years
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Afghanistan","Iso":"AFG","Percentage":85.16271428571429},{"Name":"Albania","Iso":"ALB","Percentage":100},{"Name":"Algeria","Iso":"DZA","Percentage":0.8692857142857144},{"Name":"American Samoa","Iso":"ASM","Percentage":0},{"Name":"Angola","Iso":"AGO","Percentage":71.92085714285714},{"Name":"Antarctica","Iso":"ATA","Percentage":0},{"Name":"Antigua and Barbuda","Iso":"ATG","Percentage":3.4008571428571424},{"Name":"Argentina","Iso":"ARG","Percentage":24.86485714285714},{"Name":"Armenia","Iso":"ARM","Percentage":30.715142857142858},{"Name":"Aruba","Iso":"ABW","Percentage":16.561000000000003},{"Name":"Australia","Iso":"AUS","Percentage":19.918714285714287},{"Name":"Austria","Iso":"AUT","Percentage":77.525},{"Name":"Azerbaijan","Iso":"AZE","Percentage":6.909428571428571},{"Name":"Bahamas","Iso":"BHS","Percentage":0},{"Name":"Bahrain","Iso":"BHR","Percentage":0.03457142857142857},{"Name":"Bangladesh","Iso":"BGD","Percentage":1.7357142857142858},{"Name":"Barbados","Iso":"BRB","Percentage":3.912714285714286},{"Name":"Belarus","Iso":"BLR","Percentage":2.2312857142857143},{"Name":"Belgium","Iso":"BEL","Percentage":22.041125},{"Name":"Belize","Iso":"BLZ","Percentage":55.40557142857143},{"Name":"Benin","Iso":"BEN","Percentage":1.9307142857142856},{"Name":"Bermuda","Iso":"BMU","Percentage":0},{"Name":"Bhutan","Iso":"BTN","Percentage":100},{"Name":"Bolivia","Iso":"BOL","Percentage":41.50671428571428},{"Name":"Bosnia and Herzegovina","Iso":"BIH","Percentage":34.32385714285714},{"Name":"Botswana","Iso":"BWA","Percentage":0.22942857142857145},{"Name":"Brazil","Iso":"BRA","Percentage":80.45900000000002},{"Name":"British Virgin Islands","Iso":"VGB","Percentage":0},{"Name":"Brunei","Iso":"BRN","Percentage":0},{"Name":"Bulgaria","Iso":"BGR","Percentage":17.967125},{"Name":"Burkina Faso","Iso":"BFA","Percentage":11.309714285714287},{"Name":"Burundi","Iso":"BDI","Percentage":72.11800000000001},{"Name":"Cambodia","Iso":"KHM","Percentage":52.93657142857143},{"Name":"Cameroon","Iso":"CMR","Percentage":62.29314285714286},{"Name":"Canada","Iso":"CAN","Percentage":67.21671428571429},{"Name":"Cape Verde","Iso":"CPV","Percentage":18.43757142857143},{"Name":"Cayman Islands","Iso":"CYM","Percentage":1.6498571428571431},{"Name":"Central African Republic","Iso":"CAF","Percentage":100},{"Name":"Chad","Iso":"TCD","Percentage":2.859142857142857},{"Name":"Chile","Iso":"CHL","Percentage":40.252142857142864},{"Name":"China","Iso":"CHN","Percentage":26.346857142857143},{"Name":"Colombia","Iso":"COL","Percentage":70.52285714285713},{"Name":"Comoros","Iso":"COM","Percentage":0},{"Name":"Cook Islands","Iso":"COK","Percentage":22.142857142857142},{"Name":"Costa Rica","Iso":"CRI","Percentage":97.81728571428572},{"Name":"Croatia","Iso":"HRV","Percentage":66.143125},{"Name":"Cuba","Iso":"CUB","Percentage":16.38285714285714},{"Name":"Cyprus","Iso":"CYP","Percentage":11.26125},{"Name":"Czechia","Iso":"CZE","Percentage":11.847375},{"Name":"DR Congo","Iso":"COD","Percentage":99.76814285714285},{"Name":"Denmark","Iso":"DNK","Percentage":73.367625},{"Name":"Djibouti","Iso":"DJI","Percentage":0},{"Name":"Dominica","Iso":"DMA","Percentage":28.278285714285715},{"Name":"Dominican Republic","Iso":"DOM","Percentage":14.284857142857144},{"Name":"Ecuador","Iso":"ECU","Percentage":75.69785714285715},{"Name":"Egypt","Iso":"EGY","Percentage":9.454857142857142},{"Name":"El Salvador","Iso":"SLV","Percentage":70.66499999999999},{"Name":"Equatorial Guinea","Iso":"GNQ","Percentage":33.29071428571429},{"Name":"Eritrea","Iso":"ERI","Percentage":1.663},{"Name":"Estonia","Iso":"EST","Percentage":27.443375},{"Name":"Eswatini","Iso":"SWZ","Percentage":93.9767142857143},{"Name":"Ethiopia","Iso":"ETH","Percentage":99.91014285714287},{"Name":"Falkland Islands","Iso":"FLK","Percentage":50},{"Name":"Faroe Islands","Iso":"FRO","Percentage":47.439285714285724},{"Name":"Fiji","Iso":"FJI","Percentage":61.87114285714286},{"Name":"Finland","Iso":"FIN","Percentage":48.48374999999999},{"Name":"France","Iso":"FRA","Percentage":20.0825},{"Name":"French Guiana","Iso":"GUF","Percentage":0},{"Name":"French Polynesia","Iso":"PYF","Percentage":34.340428571428575},{"Name":"Gabon","Iso":"GAB","Percentage":44.03142857142857},{"Name":"Gambia","Iso":"GMB","Percentage":0},{"Name":"Georgia","Iso":"GEO","Percentage":79.71542857142857},{"Name":"Germany","Iso":"DEU","Percentage":36.81375},{"Name":"Ghana","Iso":"GHA","Percentage":43.206},{"Name":"Gibraltar","Iso":"GIB","Percentage":0},{"Name":"Greece","Iso":"GRC","Percentage":33.089875},{"Name":"Greenland","Iso":"GRL","Percentage":82.39514285714286},{"Name":"Grenada","Iso":"GRD","Percentage":0},{"Name":"Guadeloupe","Iso":"GLP","Percentage":0},{"Name":"Guam","Iso":"GUM","Percentage":3.6840000000000006},{"Name":"Guatemala","Iso":"GTM","Percentage":64.55757142857142},{"Name":"Guinea","Iso":"GIN","Percentage":68.83357142857143},{"Name":"Guinea-Bissau","Iso":"GNB","Percentage":0},{"Name":"Guyana","Iso":"GUY","Percentage":13.575142857142856},{"Name":"Haiti","Iso":"HTI","Percentage":12.825857142857144},{"Name":"Honduras","Iso":"HND","Percentage":52.825999999999986},{"Name":"Hong Kong","Iso":"HKG","Percentage":0.03328571428571429},{"Name":"Hungary","Iso":"HUN","Percentage":14.161},{"Name":"Iceland","Iso":"ISL","Percentage":99.99814285714285},{"Name":"India","Iso":"IND","Percentage":17.310142857142857},{"Name":"Indonesia","Iso":"IDN","Percentage":16.433285714285713},{"Name":"Iran","Iso":"IRN","Percentage":6.081857142857143},{"Name":"Iraq","Iso":"IRQ","Percentage":4.4275714285714285},{"Name":"Ireland","Iso":"IRL","Percentage":33.949125},{"Name":"Israel","Iso":"ISR","Percentage":3.717428571428571},{"Name":"Italy","Iso":"ITA","Percentage":38.80575},{"Name":"Ivory Coast","Iso":"CIV","Percentage":25.82857142857143},{"Name":"Jamaica","Iso":"JAM","Percentage":14.54742857142857},{"Name":"Japan","Iso":"JPN","Percentage":18.601285714285716},{"Name":"Jordan","Iso":"JOR","Percentage":12.329142857142857},{"Name":"Kazakhstan","Iso":"KAZ","Percentage":11.40514285714286},{"Name":"Kenya","Iso":"KEN","Percentage":87.16785714285713},{"Name":"Kiribati","Iso":"KIR","Percentage":0},{"Name":"Kuwait","Iso":"KWT","Percentage":0.060000000000000005},{"Name":"Kyrgyzstan","Iso":"KGZ","Percentage":90.18057142857143},{"Name":"Laos","Iso":"LAO","Percentage":72.35942857142858},{"Name":"Latvia","Iso":"LVA","Percentage":59.71575},{"Name":"Lebanon","Iso":"LBN","Percentage":4.061428571428571},{"Name":"Lesotho","Iso":"LSO","Percentage":100},{"Name":"Liberia","Iso":"LBR","Percentage":16.737142857142857},{"Name":"Libya","Iso":"LBY","Percentage":0.03157142857142857},{"Name":"Lithuania","Iso":"LTU","Percentage":66.51887500000001},{"Name":"Luxembourg","Iso":"LUX","Percentage":68.53675},{"Name":"Macau","Iso":"MAC","Percentage":0},{"Name":"Madagascar","Iso":"MDG","Percentage":40.63557142857143},{"Name":"Malawi","Iso":"MWI","Percentage":89.14414285714284},{"Name":"Malaysia","Iso":"MYS","Percentage":15.838999999999999},{"Name":"Maldives","Iso":"MDV","Percentage":4.304},{"Name":"Mali","Iso":"MLI","Percentage":45.007},{"Name":"Malta","Iso":"MLT","Percentage":11.097375},{"Name":"Martinique","Iso":"MTQ","Percentage":0},{"Name":"Mauritania","Iso":"MRT","Percentage":25.474999999999998},{"Name":"Mauritius","Iso":"MUS","Percentage":18.76257142857143},{"Name":"Mexico","Iso":"MEX","Percentage":19.228285714285715},{"Name":"Micronesia","Iso":"FSM","Percentage":0},{"Name":"Moldova","Iso":"MDA","Percentage":5.472571428571428},{"Name":"Mongolia","Iso":"MNG","Percentage":7.21542857142857},{"Name":"Montenegro","Iso":"MNE","Percentage":54.53542857142856},{"Name":"Montserrat","Iso":"MSR","Percentage":0},{"Name":"Morocco","Iso":"MAR","Percentage":17.376428571428573},{"Name":"Mozambique","Iso":"MOZ","Percentage":83.98028571428573},{"Name":"Myanmar","Iso":"MMR","Percentage":52.151714285714284},{"Name":"Namibia","Iso":"NAM","Percentage":96.95028571428573},{"Name":"Nauru","Iso":"NRU","Percentage":0},{"Name":"Nepal","Iso":"NPL","Percentage":100},{"Name":"Netherlands","Iso":"NLD","Percentage":21.953625000000002},{"Name":"New Caledonia","Iso":"NCL","Percentage":13.900714285714285},{"Name":"New Zealand","Iso":"NZL","Percentage":81.81014285714285},{"Name":"Nicaragua","Iso":"NIC","Percentage":53.129714285714286},{"Name":"Niger","Iso":"NER","Percentage":6.57757142857143},{"Name":"Nigeria","Iso":"NGA","Percentage":24.324428571428573},{"Name":"Niue","Iso":"NIU","Percentage":0},{"Name":"North Korea","Iso":"PRK","Percentage":80.70671428571428},{"Name":"North Macedonia","Iso":"MKD","Percentage":30.10828571428572},{"Name":"Northern Mariana Islands","Iso":"MNP","Percentage":0},{"Name":"Norway","Iso":"NOR","Percentage":98.27971428571428},{"Name":"Oman","Iso":"OMN","Percentage":0.141},{"Name":"Pakistan","Iso":"PAK","Percentage":29.63771428571429},{"Name":"Palestine","Iso":"PSE","Percentage":13.697285714285714},{"Name":"Panama","Iso":"PAN","Percentage":72.93500000000002},{"Name":"Papua New Guinea","Iso":"PNG","Percentage":30.279571428571426},{"Name":"Paraguay","Iso":"PRY","Percentage":99.92271428571429},{"Name":"Peru","Iso":"PER","Percentage":58.62971428571429},{"Name":"Philippines","Iso":"PHL","Percentage":23.66014285714286},{"Name":"Poland","Iso":"POL","Percentage":15.76975},{"Name":"Portugal","Iso":"PRT","Percentage":53.33525},{"Name":"Puerto Rico","Iso":"PRI","Percentage":2.2467142857142854},{"Name":"Qatar","Iso":"QAT","Percentage":0.09185714285714286},{"Name":"Republic of the Congo","Iso":"COG","Percentage":34.449571428571424},{"Name":"Romania","Iso":"ROU","Percentage":41.583999999999996},{"Name":"Russia","Iso":"RUS","Percentage":18.630857142857142},{"Name":"Rwanda","Iso":"RWA","Percentage":51.53871428571428},{"Name":"Réunion","Iso":"REU","Percentage":0},{"Name":"Saint Helena, Ascension and Tristan da Cunha","Iso":"SHN","Percentage":0},{"Name":"Saint Kitts and Nevis","Iso":"KNA","Percentage":4.022714285714286},{"Name":"Saint Lucia","Iso":"LCA","Percentage":0},{"Name":"Saint Pierre and Miquelon","Iso":"SPM","Percentage":0},{"Name":"Saint Vincent and the Grenadines","Iso":"VCT","Percentage":17.449142857142856},{"Name":"Samoa","Iso":"WSM","Percentage":36.42728571428571},{"Name":"Saudi Arabia","Iso":"SAU","Percentage":0.06514285714285714},{"Name":"Senegal","Iso":"SEN","Percentage":15.480428571428572},{"Name":"Serbia","Iso":"SRB","Percentage":28.51571428571429},{"Name":"Seychelles","Iso":"SYC","Percentage":5.720999999999999},{"Name":"Sierra Leone","Iso":"SLE","Percentage":81.23928571428571},{"Name":"Singapore","Iso":"SGP","Percentage":1.407857142857143},{"Name":"Slovakia","Iso":"SVK","Percentage":23.521125000000005},{"Name":"Slovenia","Iso":"SVN","Percentage":31.235},{"Name":"Solomon Islands","Iso":"SLB","Percentage":0},{"Name":"Somalia","Iso":"SOM","Percentage":5.390571428571429},{"Name":"South Africa","Iso":"ZAF","Percentage":4.851857142857143},{"Name":"South Korea","Iso":"KOR","Percentage":5.335571428571428},{"Name":"South Sudan","Iso":"SSD","Percentage":1.0254285714285716},{"Name":"Spain","Iso":"ESP","Percentage":39.218250000000005},{"Name":"Sri Lanka","Iso":"LKA","Percentage":39.42485714285714},{"Name":"Sudan","Iso":"SDN","Percentage":66.47514285714286},{"Name":"Suriname","Iso":"SUR","Percentage":45.70585714285715},{"Name":"Sweden","Iso":"SWE","Percentage":62.1385},{"Name":"Switzerland","Iso":"CHE","Percentage":59.264714285714284},{"Name":"Syria","Iso":"SYR","Percentage":4.373571428571428},{"Name":"São Tomé and Príncipe","Iso":"STP","Percentage":10.992},{"Name":"Taiwan","Iso":"TWN","Percentage":4.4192857142857145},{"Name":"Tajikistan","Iso":"TJK","Percentage":94.31928571428571},{"Name":"Tanzania","Iso":"TZA","Percentage":44.168857142857135},{"Name":"Thailand","Iso":"THA","Percentage":12.161285714285713},{"Name":"Timor-Leste","Iso":"TLS","Percentage":0},{"Name":"Togo","Iso":"TGO","Percentage":30.771857142857147},{"Name":"Tonga","Iso":"TON","Percentage":10.289285714285715},{"Name":"Trinidad and Tobago","Iso":"TTO","Percentage":0.11514285714285714},{"Name":"Tunisia","Iso":"TUN","Percentage":3.7265714285714284},{"Name":"Turkey","Iso":"TUR","Percentage":35.37471428571428},{"Name":"Turkmenistan","Iso":"TKM","Percentage":0},{"Name":"Turks and Caicos Islands","Iso":"TCA","Percentage":0},{"Name":"Tuvalu","Iso":"TUV","Percentage":0},{"Name":"Uganda","Iso":"UGA","Percentage":94.37842857142856},{"Name":"Ukraine","Iso":"UKR","Percentage":8.429142857142859},{"Name":"United Arab Emirates","Iso":"ARE","Percentage":2.052},{"Name":"United Kingdom","Iso":"GBR","Percentage":33.17057142857143},{"Name":"United States","Iso":"USA","Percentage":17.596714285714288},{"Name":"United States Virgin Islands","Iso":"VIR","Percentage":1.7825714285714287},{"Name":"Uruguay","Iso":"URY","Percentage":86.57071428571429},{"Name":"Uzbekistan","Iso":"UZB","Percentage":11.169},{"Name":"Vanuatu","Iso":"VUT","Percentage":26.87042857142857},{"Name":"Venezuela","Iso":"VEN","Percentage":61.78857142857144},{"Name":"Vietnam","Iso":"VNM","Percentage":38.64714285714285},{"Name":"Western Sahara","Iso":"ESH","Percentage":0},{"Name":"Yemen","Iso":"YEM","Percentage":10.183714285714286},{"Name":"Zambia","Iso":"ZMB","Percentage":90.06171428571429},{"Name":"Zimbabwe","Iso":"ZWE","Percentage":55.639}]`
	testUrl = "/energy/v1/renewables/history/?begin=2015"
	// Test the /energy/v1/renewables/history/rus endpoint where it gets data from each country and their average percentage for the year 2015 and ater
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Afghanistan","Iso":"AFG","Percentage":0},{"Name":"Albania","Iso":"ALB","Percentage":0},{"Name":"Algeria","Iso":"DZA","Percentage":0},{"Name":"Angola","Iso":"AGO","Percentage":0},{"Name":"Argentina","Iso":"ARG","Percentage":0},{"Name":"Australia","Iso":"AUS","Percentage":0},{"Name":"Austria","Iso":"AUT","Percentage":0},{"Name":"Bahrain","Iso":"BHR","Percentage":0},{"Name":"Bangladesh","Iso":"BGD","Percentage":0},{"Name":"Barbados","Iso":"BRB","Percentage":0},{"Name":"Belgium","Iso":"BEL","Percentage":0},{"Name":"Bolivia","Iso":"BOL","Percentage":0},{"Name":"Botswana","Iso":"BWA","Percentage":0},{"Name":"Brazil","Iso":"BRA","Percentage":0},{"Name":"Brunei","Iso":"BRN","Percentage":0},{"Name":"Bulgaria","Iso":"BGR","Percentage":0},{"Name":"Burundi","Iso":"BDI","Percentage":0},{"Name":"Cameroon","Iso":"CMR","Percentage":0},{"Name":"Canada","Iso":"CAN","Percentage":0},{"Name":"Chile","Iso":"CHL","Percentage":0},{"Name":"China","Iso":"CHN","Percentage":0},{"Name":"Colombia","Iso":"COL","Percentage":0},{"Name":"Cuba","Iso":"CUB","Percentage":0},{"Name":"DR Congo","Iso":"COD","Percentage":0},{"Name":"Denmark","Iso":"DNK","Percentage":0},{"Name":"Ecuador","Iso":"ECU","Percentage":0},{"Name":"Egypt","Iso":"EGY","Percentage":0},{"Name":"Eswatini","Iso":"SWZ","Percentage":0},{"Name":"France","Iso":"FRA","Percentage":0},{"Name":"Gabon","Iso":"GAB","Percentage":0},{"Name":"Germany","Iso":"DEU","Percentage":0},{"Name":"Ghana","Iso":"GHA","Percentage":0},{"Name":"Greece","Iso":"GRC","Percentage":0},{"Name":"Greenland","Iso":"GRL","Percentage":0},{"Name":"Guatemala","Iso":"GTM","Percentage":0},{"Name":"Hungary","Iso":"HUN","Percentage":0},{"Name":"India","Iso":"IND","Percentage":0},{"Name":"Indonesia","Iso":"IDN","Percentage":0},{"Name":"Iran","Iso":"IRN","Percentage":0},{"Name":"Iraq","Iso":"IRQ","Percentage":0},{"Name":"Ireland","Iso":"IRL","Percentage":0},{"Name":"Israel","Iso":"ISR","Percentage":0},{"Name":"Italy","Iso":"ITA","Percentage":0},{"Name":"Ivory Coast","Iso":"CIV","Percentage":0},{"Name":"Japan","Iso":"JPN","Percentage":0},{"Name":"Kuwait","Iso":"KWT","Percentage":0},{"Name":"Libya","Iso":"LBY","Percentage":0},{"Name":"Madagascar","Iso":"MDG","Percentage":0},{"Name":"Malaysia","Iso":"MYS","Percentage":0},{"Name":"Mexico","Iso":"MEX","Percentage":0},{"Name":"Mongolia","Iso":"MNG","Percentage":0},{"Name":"Morocco","Iso":"MAR","Percentage":0},{"Name":"Mozambique","Iso":"MOZ","Percentage":0},{"Name":"Myanmar","Iso":"MMR","Percentage":0},{"Name":"Nepal","Iso":"NPL","Percentage":0},{"Name":"Netherlands","Iso":"NLD","Percentage":0},{"Name":"New Zealand","Iso":"NZL","Percentage":0},{"Name":"Niger","Iso":"NER","Percentage":0},{"Name":"Nigeria","Iso":"NGA","Percentage":0},{"Name":"North Korea","Iso":"PRK","Percentage":0},{"Name":"Norway","Iso":"NOR","Percentage":0},{"Name":"Oman","Iso":"OMN","Percentage":0},{"Name":"Pakistan","Iso":"PAK","Percentage":0},{"Name":"Peru","Iso":"PER","Percentage":0},{"Name":"Philippines","Iso":"PHL","Percentage":0},{"Name":"Poland","Iso":"POL","Percentage":0},{"Name":"Portugal","Iso":"PRT","Percentage":0},{"Name":"Qatar","Iso":"QAT","Percentage":0},{"Name":"Republic of the Congo","Iso":"COG","Percentage":0},{"Name":"Romania","Iso":"ROU","Percentage":0},{"Name":"Saudi Arabia","Iso":"SAU","Percentage":0},{"Name":"South Africa","Iso":"ZAF","Percentage":0},{"Name":"South Korea","Iso":"KOR","Percentage":0},{"Name":"Spain","Iso":"ESP","Percentage":0},{"Name":"Suriname","Iso":"SUR","Percentage":0},{"Name":"Sweden","Iso":"SWE","Percentage":0},{"Name":"Switzerland","Iso":"CHE","Percentage":0},{"Name":"Syria","Iso":"SYR","Percentage":0},{"Name":"Taiwan","Iso":"TWN","Percentage":0},{"Name":"Tanzania","Iso":"TZA","Percentage":0},{"Name":"Thailand","Iso":"THA","Percentage":0},{"Name":"Trinidad and Tobago","Iso":"TTO","Percentage":0},{"Name":"Tunisia","Iso":"TUN","Percentage":0},{"Name":"Turkey","Iso":"TUR","Percentage":0},{"Name":"Ukraine","Iso":"UKR","Percentage":0},{"Name":"United Arab Emirates","Iso":"ARE","Percentage":0},{"Name":"United Kingdom","Iso":"GBR","Percentage":0},{"Name":"United States","Iso":"USA","Percentage":0},{"Name":"Venezuela","Iso":"VEN","Percentage":0},{"Name":"Vietnam","Iso":"VNM","Percentage":0},{"Name":"Zambia","Iso":"ZMB","Percentage":0},{"Name":"Zimbabwe","Iso":"ZWE","Percentage":0}]`
	testUrl = "/energy/v1/renewables/history/?end=1902"
	// Test the /energy/v1/renewables/history/rus endpoint where it gets data from each country and their average percentage for the years 1902 and before
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
}

// testing all type of Url with the current handler
func TestCurrentHandler(t *testing.T) {
	var expected = `[{"Name":"Norway","Iso":"NOR","Borders":["FIN","SWE","RUS"],"Percentage":99.544,"Year":2021}]`
	var testUrl = "/energy/v1/renewables/current/nor"
	var thisHandler = handler.CurrentHandler
	// Test the /energy/v1/renewables/current/nor endpoint it takes the newest data from the country chosen
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Norway","Iso":"NOR","Borders":["FIN","SWE","RUS"],"Percentage":99.544,"Year":2021},{"Name":"Finland","Iso":"FIN","Borders":["NOR","SWE","RUS"],"Percentage":52.907,"Year":2021},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":67.381,"Year":2021},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.959,"Year":2021}]`
	testUrl = "/energy/v1/renewables/current/nor?neighbours=True"
	// Test the /energy/v1/renewables/current/nor?neighbours=True endpoint it takes the newest data from the country chosen and the neighbours of that country
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Norway","Iso":"NOR","Borders":["FIN","SWE","RUS"],"Percentage":99.544,"Year":2021}]`
	testUrl = "/energy/v1/renewables/current/nor?neighbours=False"
	// Test the /energy/v1/renewables/current/nor?neighbours=False endpoint it takes the newest data from the country chosen and ignores the neighbours like the first test
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
	expected = `[{"Name":"Afghanistan","Iso":"AFG","Borders":["IRN","PAK","TKM","UZB","TJK","CHN"],"Percentage":84.337,"Year":2021},{"Name":"Albania","Iso":"ALB","Borders":["MNE","GRC","MKD","UNK"],"Percentage":100,"Year":2020},{"Name":"Algeria","Iso":"DZA","Borders":["TUN","LBY","NER","ESH","MRT","MLI","MAR"],"Percentage":1.174,"Year":2021},{"Name":"American Samoa","Iso":"ASM","Percentage":0,"Year":2021},{"Name":"Angola","Iso":"AGO","Borders":["COG","COD","ZMB","NAM"],"Percentage":71.82,"Year":2021},{"Name":"Antarctica","Iso":"ATA","Percentage":0,"Year":2019},{"Name":"Antigua and Barbuda","Iso":"ATG","Percentage":5.714,"Year":2021},{"Name":"Argentina","Iso":"ARG","Borders":["BOL","BRA","CHL","PRY","URY"],"Percentage":25.348,"Year":2021},{"Name":"Armenia","Iso":"ARM","Borders":["AZE","GEO","IRN","TUR"],"Percentage":31.284,"Year":2021},{"Name":"Aruba","Iso":"ABW","Percentage":16.129,"Year":2021},{"Name":"Australia","Iso":"AUS","Percentage":29.135,"Year":2021},{"Name":"Austria","Iso":"AUT","Borders":["CZE","DEU","HUN","ITA","LIE","SVK","SVN","CHE"],"Percentage":76.287,"Year":2022},{"Name":"Azerbaijan","Iso":"AZE","Borders":["ARM","GEO","IRN","RUS","TUR"],"Percentage":5.401,"Year":2021},{"Name":"Bahamas","Iso":"BHS","Percentage":0,"Year":2021},{"Name":"Bahrain","Iso":"BHR","Percentage":0.031,"Year":2021},{"Name":"Bangladesh","Iso":"BGD","Borders":["MMR","IND"],"Percentage":1.725,"Year":2021},{"Name":"Barbados","Iso":"BRB","Percentage":7.477,"Year":2021},{"Name":"Belarus","Iso":"BLR","Borders":["LVA","LTU","POL","RUS","UKR"],"Percentage":2.986,"Year":2021},{"Name":"Belgium","Iso":"BEL","Borders":["FRA","DEU","LUX","NLD"],"Percentage":25.449,"Year":2022},{"Name":"Belize","Iso":"BLZ","Borders":["GTM","MEX"],"Percentage":40.625,"Year":2021},{"Name":"Benin","Iso":"BEN","Borders":["BFA","NER","NGA","TGO"],"Percentage":4.167,"Year":2021},{"Name":"Bermuda","Iso":"BMU","Percentage":0,"Year":2021},{"Name":"Bhutan","Iso":"BTN","Borders":["CHN","IND"],"Percentage":100,"Year":2021},{"Name":"Bolivia","Iso":"BOL","Borders":["ARG","BRA","CHL","PRY","PER"],"Percentage":41.737,"Year":2021},{"Name":"Bosnia and Herzegovina","Iso":"BIH","Borders":["HRV","MNE","SRB"],"Percentage":41.369,"Year":2021},{"Name":"Botswana","Iso":"BWA","Borders":["NAM","ZAF","ZMB","ZWE"],"Percentage":0.457,"Year":2021},{"Name":"Brazil","Iso":"BRA","Borders":["ARG","BOL","COL","GUF","GUY","PRY","PER","SUR","URY","VEN"],"Percentage":76.771,"Year":2021},{"Name":"British Virgin Islands","Iso":"VGB","Percentage":0,"Year":2021},{"Name":"Brunei","Iso":"BRN","Borders":["MYS"],"Percentage":0,"Year":2021},{"Name":"Bulgaria","Iso":"BGR","Borders":["GRC","MKD","ROU","SRB","TUR"],"Percentage":18.703,"Year":2022},{"Name":"Burkina Faso","Iso":"BFA","Borders":["BEN","CIV","GHA","MLI","NER","TGO"],"Percentage":13.143,"Year":2021},{"Name":"Burundi","Iso":"BDI","Borders":["COD","RWA","TZA"],"Percentage":66.667,"Year":2021},{"Name":"Cambodia","Iso":"KHM","Borders":["LAO","THA","VNM"],"Percentage":52.934,"Year":2021},{"Name":"Cameroon","Iso":"CMR","Borders":["CAF","TCD","COG","GNQ","GAB","NGA"],"Percentage":62.36,"Year":2021},{"Name":"Canada","Iso":"CAN","Borders":["USA"],"Percentage":68.17,"Year":2021},{"Name":"Cape Verde","Iso":"CPV","Percentage":15.556,"Year":2021},{"Name":"Cayman Islands","Iso":"CYM","Percentage":2.74,"Year":2021},{"Name":"Central African Republic","Iso":"CAF","Borders":["CMR","TCD","COD","COG","SSD","SDN"],"Percentage":100,"Year":2021},{"Name":"Chad","Iso":"TCD","Borders":["CMR","CAF","LBY","NER","NGA","SDN"],"Percentage":3.226,"Year":2021},{"Name":"Chile","Iso":"CHL","Borders":["ARG","BOL","PER"],"Percentage":42.706,"Year":2021},{"Name":"China","Iso":"CHN","Borders":["AFG","BTN","MMR","HKG","IND","KAZ","NPL","PRK","KGZ","LAO","MAC","MNG","PAK","RUS","TJK","VNM"],"Percentage":28.908,"Year":2021},{"Name":"Colombia","Iso":"COL","Borders":["BRA","ECU","PAN","PER","VEN"],"Percentage":73.65,"Year":2021},{"Name":"Comoros","Iso":"COM","Percentage":0,"Year":2021},{"Name":"Cook Islands","Iso":"COK","Percentage":40,"Year":2021},{"Name":"Costa Rica","Iso":"CRI","Borders":["NIC","PAN"],"Percentage":98.741,"Year":2021},{"Name":"Croatia","Iso":"HRV","Borders":["BIH","HUN","MNE","SRB","SVN"],"Percentage":63.314,"Year":2022},{"Name":"Cuba","Iso":"CUB","Percentage":21.367,"Year":2021},{"Name":"Cyprus","Iso":"CYP","Percentage":16.698,"Year":2022},{"Name":"Czechia","Iso":"CZE","Borders":["AUT","DEU","POL","SVK"],"Percentage":12.337,"Year":2022},{"Name":"DR Congo","Iso":"COD","Borders":["AGO","BDI","CAF","COG","RWA","SSD","TZA","UGA","ZMB"],"Percentage":99.728,"Year":2021},{"Name":"Denmark","Iso":"DNK","Borders":["DEU"],"Percentage":83.963,"Year":2022},{"Name":"Djibouti","Iso":"DJI","Borders":["ERI","ETH","SOM"],"Percentage":0,"Year":2021},{"Name":"Dominica","Iso":"DMA","Percentage":23.529,"Year":2021},{"Name":"Dominican Republic","Iso":"DOM","Borders":["HTI"],"Percentage":17.179,"Year":2021},{"Name":"Ecuador","Iso":"ECU","Borders":["COL","PER"],"Percentage":83.55,"Year":2021},{"Name":"Egypt","Iso":"EGY","Borders":["ISR","LBY","PSE","SDN"],"Percentage":11.387,"Year":2021},{"Name":"El Salvador","Iso":"SLV","Borders":["GTM","HND"],"Percentage":79.573,"Year":2021},{"Name":"Equatorial Guinea","Iso":"GNQ","Borders":["CMR","GAB"],"Percentage":30.986,"Year":2021},{"Name":"Eritrea","Iso":"ERI","Borders":["DJI","ETH","SDN"],"Percentage":2.222,"Year":2021},{"Name":"Estonia","Iso":"EST","Borders":["LVA","RUS"],"Percentage":44.005,"Year":2022},{"Name":"Eswatini","Iso":"SWZ","Borders":["MOZ","ZAF"],"Percentage":94.595,"Year":2021},{"Name":"Ethiopia","Iso":"ETH","Borders":["DJI","ERI","KEN","SOM","SSD","SDN"],"Percentage":99.932,"Year":2021},{"Name":"Falkland Islands","Iso":"FLK","Percentage":50,"Year":2021},{"Name":"Faroe Islands","Iso":"FRO","Percentage":38.095,"Year":2021},{"Name":"Fiji","Iso":"FJI","Percentage":62.832,"Year":2021},{"Name":"Finland","Iso":"FIN","Borders":["NOR","SWE","RUS"],"Percentage":54.633,"Year":2022},{"Name":"France","Iso":"FRA","Borders":["AND","BEL","DEU","ITA","LUX","MCO","ESP","CHE"],"Percentage":24.542,"Year":2022},{"Name":"French Guiana","Iso":"GUF","Borders":["BRA","SUR"],"Percentage":0,"Year":2021},{"Name":"French Polynesia","Iso":"PYF","Percentage":32.857,"Year":2021},{"Name":"Gabon","Iso":"GAB","Borders":["CMR","COG","GNQ"],"Percentage":44.541,"Year":2021},{"Name":"Gambia","Iso":"GMB","Borders":["SEN"],"Percentage":0,"Year":2021},{"Name":"Georgia","Iso":"GEO","Borders":["ARM","AZE","RUS","TUR"],"Percentage":81.171,"Year":2021},{"Name":"Germany","Iso":"DEU","Borders":["AUT","BEL","CZE","DNK","FRA","LUX","NLD","POL","CHE"],"Percentage":42.894,"Year":2022},{"Name":"Ghana","Iso":"GHA","Borders":["BFA","CIV","TGO"],"Percentage":34.862,"Year":2021},{"Name":"Gibraltar","Iso":"GIB","Borders":["ESP"],"Percentage":0,"Year":2021},{"Name":"Greece","Iso":"GRC","Borders":["ALB","BGR","TUR","MKD"],"Percentage":43.307,"Year":2022},{"Name":"Greenland","Iso":"GRL","Percentage":83.333,"Year":2021},{"Name":"Grenada","Iso":"GRD","Percentage":0,"Year":2021},{"Name":"Guadeloupe","Iso":"GLP","Percentage":0,"Year":2021},{"Name":"Guam","Iso":"GUM","Percentage":4.396,"Year":2021},{"Name":"Guatemala","Iso":"GTM","Borders":["BLZ","SLV","HND","MEX"],"Percentage":66.551,"Year":2021},{"Name":"Guinea","Iso":"GIN","Borders":["CIV","GNB","LBR","MLI","SEN","SLE"],"Percentage":72.662,"Year":2021},{"Name":"Guinea-Bissau","Iso":"GNB","Borders":["GIN","SEN"],"Percentage":0,"Year":2021},{"Name":"Guyana","Iso":"GUY","Borders":["BRA","SUR","VEN"],"Percentage":13.008,"Year":2021},{"Name":"Haiti","Iso":"HTI","Borders":["DOM"],"Percentage":13.131,"Year":2021},{"Name":"Honduras","Iso":"HND","Borders":["GTM","SLV","NIC"],"Percentage":52.047,"Year":2021},{"Name":"Hong Kong","Iso":"HKG","Borders":["CHN"],"Percentage":0.057,"Year":2021},{"Name":"Hungary","Iso":"HUN","Borders":["AUT","HRV","ROU","SRB","SVK","SVN","UKR"],"Percentage":21.199,"Year":2022},{"Name":"Iceland","Iso":"ISL","Percentage":99.987,"Year":2021},{"Name":"India","Iso":"IND","Borders":["BGD","BTN","MMR","CHN","NPL","PAK"],"Percentage":19.384,"Year":2021},{"Name":"Indonesia","Iso":"IDN","Borders":["TLS","MYS","PNG"],"Percentage":18.189,"Year":2021},{"Name":"Iran","Iso":"IRN","Borders":["AFG","ARM","AZE","IRQ","PAK","TUR","TKM"],"Percentage":4.664,"Year":2021},{"Name":"Iraq","Iso":"IRQ","Borders":["IRN","JOR","KWT","SAU","SYR","TUR"],"Percentage":5.429,"Year":2021},{"Name":"Ireland","Iso":"IRL","Borders":["GBR"],"Percentage":39.487,"Year":2022},{"Name":"Israel","Iso":"ISR","Borders":["EGY","JOR","LBN","PSE","SYR"],"Percentage":6.787,"Year":2021},{"Name":"Italy","Iso":"ITA","Borders":["AUT","FRA","SMR","SVN","CHE","VAT"],"Percentage":36.438,"Year":2022},{"Name":"Ivory Coast","Iso":"CIV","Borders":["BFA","GHA","GIN","LBR","MLI"],"Percentage":30.146,"Year":2021},{"Name":"Jamaica","Iso":"JAM","Percentage":16.322,"Year":2021},{"Name":"Japan","Iso":"JPN","Percentage":22.611,"Year":2021},{"Name":"Jordan","Iso":"JOR","Borders":["IRQ","ISR","PSE","SAU","SYR"],"Percentage":23.537,"Year":2021},{"Name":"Kazakhstan","Iso":"KAZ","Borders":["CHN","KGZ","RUS","TKM","UZB"],"Percentage":12.439,"Year":2021},{"Name":"Kenya","Iso":"KEN","Borders":["ETH","SOM","SSD","TZA","UGA"],"Percentage":91.716,"Year":2021},{"Name":"Kiribati","Iso":"KIR","Percentage":0,"Year":2021},{"Name":"Kuwait","Iso":"KWT","Borders":["IRQ","SAU"],"Percentage":0.07,"Year":2021},{"Name":"Kyrgyzstan","Iso":"KGZ","Borders":["CHN","KAZ","TJK","UZB"],"Percentage":89.841,"Year":2021},{"Name":"Laos","Iso":"LAO","Borders":["MMR","KHM","CHN","THA","VNM"],"Percentage":72.955,"Year":2021},{"Name":"Latvia","Iso":"LVA","Borders":["BLR","EST","LTU","RUS"],"Percentage":72.134,"Year":2022},{"Name":"Lebanon","Iso":"LBN","Borders":["ISR","SYR"],"Percentage":5.639,"Year":2021},{"Name":"Lesotho","Iso":"LSO","Borders":["ZAF"],"Percentage":100,"Year":2021},{"Name":"Liberia","Iso":"LBR","Borders":["GIN","CIV","SLE"],"Percentage":57.609,"Year":2021},{"Name":"Libya","Iso":"LBY","Borders":["DZA","TCD","EGY","NER","SDN","TUN"],"Percentage":0.031,"Year":2021},{"Name":"Lithuania","Iso":"LTU","Borders":["BLR","LVA","POL","RUS"],"Percentage":74.82,"Year":2022},{"Name":"Luxembourg","Iso":"LUX","Borders":["BEL","FRA","DEU"],"Percentage":85.714,"Year":2022},{"Name":"Macau","Iso":"MAC","Borders":["CHN"],"Percentage":0,"Year":2021},{"Name":"Madagascar","Iso":"MDG","Percentage":34.45,"Year":2021},{"Name":"Malawi","Iso":"MWI","Borders":["MOZ","TZA","ZMB"],"Percentage":83.803,"Year":2021},{"Name":"Malaysia","Iso":"MYS","Borders":["BRN","IDN","THA"],"Percentage":19.314,"Year":2021},{"Name":"Maldives","Iso":"MDV","Percentage":7.576,"Year":2021},{"Name":"Mali","Iso":"MLI","Borders":["DZA","BFA","GIN","CIV","MRT","NER","SEN"],"Percentage":35.988,"Year":2021},{"Name":"Malta","Iso":"MLT","Percentage":12.442,"Year":2022},{"Name":"Martinique","Iso":"MTQ","Percentage":0,"Year":2021},{"Name":"Mauritania","Iso":"MRT","Borders":["DZA","MLI","SEN","ESH"],"Percentage":26.596,"Year":2021},{"Name":"Mauritius","Iso":"MUS","Percentage":21.181,"Year":2021},{"Name":"Mexico","Iso":"MEX","Borders":["BLZ","GTM","USA"],"Percentage":23.935,"Year":2021},{"Name":"Micronesia","Iso":"FSM","Percentage":0,"Year":2019},{"Name":"Moldova","Iso":"MDA","Borders":["ROU","UKR"],"Percentage":6.456,"Year":2021},{"Name":"Mongolia","Iso":"MNG","Borders":["CHN","RUS"],"Percentage":9.831,"Year":2021},{"Name":"Montenegro","Iso":"MNE","Borders":["ALB","BIH","HRV","UNK","SRB"],"Percentage":60.63,"Year":2021},{"Name":"Montserrat","Iso":"MSR","Percentage":0,"Year":2021},{"Name":"Morocco","Iso":"MAR","Borders":["DZA","ESH","ESP"],"Percentage":19.806,"Year":2021},{"Name":"Mozambique","Iso":"MOZ","Borders":["MWI","ZAF","SWZ","TZA","ZMB","ZWE"],"Percentage":81.416,"Year":2021},{"Name":"Myanmar","Iso":"MMR","Borders":["BGD","CHN","IND","LAO","THA"],"Percentage":41.905,"Year":2021},{"Name":"Namibia","Iso":"NAM","Borders":["AGO","BWA","ZAF","ZMB"],"Percentage":95.541,"Year":2021},{"Name":"Nauru","Iso":"NRU","Percentage":0,"Year":2021},{"Name":"Nepal","Iso":"NPL","Borders":["CHN","IND"],"Percentage":100,"Year":2021},{"Name":"Netherlands","Iso":"NLD","Borders":["BEL","DEU"],"Percentage":39.537,"Year":2022},{"Name":"New Caledonia","Iso":"NCL","Percentage":13.69,"Year":2021},{"Name":"New Zealand","Iso":"NZL","Percentage":80.723,"Year":2021},{"Name":"Nicaragua","Iso":"NIC","Borders":["CRI","HND"],"Percentage":54.644,"Year":2021},{"Name":"Niger","Iso":"NER","Borders":["DZA","BEN","BFA","TCD","LBY","MLI","NGA"],"Percentage":11.111,"Year":2021},{"Name":"Nigeria","Iso":"NGA","Borders":["BEN","CMR","TCD","NER"],"Percentage":25.643,"Year":2021},{"Name":"Niue","Iso":"NIU","Percentage":0,"Year":2021},{"Name":"North Korea","Iso":"PRK","Borders":["CHN","KOR","RUS"],"Percentage":83.183,"Year":2021},{"Name":"North Macedonia","Iso":"MKD","Borders":["ALB","BGR","GRC","UNK","SRB"],"Percentage":29.545,"Year":2021},{"Name":"Northern Mariana Islands","Iso":"MNP","Percentage":0,"Year":2019},{"Name":"Norway","Iso":"NOR","Borders":["FIN","SWE","RUS"],"Percentage":99.544,"Year":2021},{"Name":"Oman","Iso":"OMN","Borders":["SAU","ARE","YEM"],"Percentage":0.438,"Year":2021},{"Name":"Pakistan","Iso":"PAK","Borders":["AFG","CHN","IND","IRN"],"Percentage":29.74,"Year":2021},{"Name":"Palestine","Iso":"PSE","Borders":["ISR","EGY","JOR"],"Percentage":23.256,"Year":2021},{"Name":"Panama","Iso":"PAN","Borders":["COL","CRI"],"Percentage":74.441,"Year":2021},{"Name":"Papua New Guinea","Iso":"PNG","Borders":["IDN"],"Percentage":26.543,"Year":2021},{"Name":"Paraguay","Iso":"PRY","Borders":["ARG","BOL","BRA"],"Percentage":99.825,"Year":2021},{"Name":"Peru","Iso":"PER","Borders":["BOL","BRA","CHL","COL","ECU"],"Percentage":60.612,"Year":2021},{"Name":"Philippines","Iso":"PHL","Percentage":22.126,"Year":2021},{"Name":"Poland","Iso":"POL","Borders":["BLR","CZE","DEU","LTU","RUS","SVK","UKR"],"Percentage":20.977,"Year":2022},{"Name":"Portugal","Iso":"PRT","Borders":["ESP"],"Percentage":59.817,"Year":2022},{"Name":"Puerto Rico","Iso":"PRI","Percentage":2.796,"Year":2021},{"Name":"Qatar","Iso":"QAT","Borders":["SAU"],"Percentage":0.084,"Year":2021},{"Name":"Republic of the Congo","Iso":"COG","Borders":["AGO","CMR","CAF","COD","GAB"],"Percentage":24.129,"Year":2021},{"Name":"Romania","Iso":"ROU","Borders":["BGR","HUN","MDA","SRB","UKR"],"Percentage":42.149,"Year":2022},{"Name":"Russia","Iso":"RUS","Borders":["AZE","BLR","CHN","EST","FIN","GEO","KAZ","PRK","LVA","LTU","MNG","NOR","POL","UKR"],"Percentage":19.959,"Year":2021},{"Name":"Rwanda","Iso":"RWA","Borders":["BDI","COD","TZA","UGA"],"Percentage":60,"Year":2021},{"Name":"Réunion","Iso":"REU","Percentage":0,"Year":2021},{"Name":"Saint Helena, Ascension and Tristan da Cunha","Iso":"SHN","Percentage":0,"Year":2021},{"Name":"Saint Kitts and Nevis","Iso":"KNA","Percentage":4.545,"Year":2021},{"Name":"Saint Lucia","Iso":"LCA","Percentage":0,"Year":2021},{"Name":"Saint Pierre and Miquelon","Iso":"SPM","Percentage":0,"Year":2021},{"Name":"Saint Vincent and the Grenadines","Iso":"VCT","Percentage":25,"Year":2021},{"Name":"Samoa","Iso":"WSM","Percentage":35.294,"Year":2021},{"Name":"Saudi Arabia","Iso":"SAU","Borders":["IRQ","JOR","KWT","OMN","QAT","ARE","YEM"],"Percentage":0.233,"Year":2021},{"Name":"Senegal","Iso":"SEN","Borders":["GMB","GIN","GNB","MLI","MRT"],"Percentage":20.143,"Year":2021},{"Name":"Serbia","Iso":"SRB","Borders":["BIH","BGR","HRV","HUN","UNK","MKD","MNE","ROU"],"Percentage":33.432,"Year":2021},{"Name":"Seychelles","Iso":"SYC","Percentage":12.308,"Year":2021},{"Name":"Sierra Leone","Iso":"SLE","Borders":["GIN","LBR"],"Percentage":90.476,"Year":2021},{"Name":"Singapore","Iso":"SGP","Percentage":2.076,"Year":2021},{"Name":"Slovakia","Iso":"SVK","Borders":["AUT","CZE","HUN","POL","UKR"],"Percentage":23.501,"Year":2022},{"Name":"Slovenia","Iso":"SVN","Borders":["AUT","HRV","ITA","HUN"],"Percentage":29.616,"Year":2022},{"Name":"Solomon Islands","Iso":"SLB","Percentage":0,"Year":2021},{"Name":"Somalia","Iso":"SOM","Borders":["DJI","ETH","KEN"],"Percentage":9.756,"Year":2021},{"Name":"South Africa","Iso":"ZAF","Borders":["BWA","LSO","MOZ","NAM","SWZ","ZWE"],"Percentage":7.563,"Year":2021},{"Name":"South Korea","Iso":"KOR","Borders":["PRK"],"Percentage":7.774,"Year":2021},{"Name":"South Sudan","Iso":"SSD","Borders":["CAF","COD","ETH","KEN","SDN","UGA"],"Percentage":1.754,"Year":2021},{"Name":"Spain","Iso":"ESP","Borders":["AND","FRA","GIB","PRT","MAR"],"Percentage":42.218,"Year":2022},{"Name":"Sri Lanka","Iso":"LKA","Borders":["IND"],"Percentage":37.714,"Year":2021},{"Name":"Sudan","Iso":"SDN","Borders":["CAF","TCD","EGY","ERI","ETH","LBY","SSD"],"Percentage":66.124,"Year":2021},{"Name":"Suriname","Iso":"SUR","Borders":["BRA","GUF","GUY"],"Percentage":50.495,"Year":2021},{"Name":"Sweden","Iso":"SWE","Borders":["FIN","NOR"],"Percentage":68.383,"Year":2022},{"Name":"Switzerland","Iso":"CHE","Borders":["AUT","FRA","ITA","LIE","DEU"],"Percentage":66.057,"Year":2021},{"Name":"Syria","Iso":"SYR","Borders":["IRQ","ISR","JOR","LBN","TUR"],"Percentage":4.535,"Year":2021},{"Name":"São Tomé and Príncipe","Iso":"STP","Percentage":10,"Year":2021},{"Name":"Taiwan","Iso":"TWN","Percentage":5.439,"Year":2021},{"Name":"Tajikistan","Iso":"TJK","Borders":["AFG","CHN","KGZ","UZB"],"Percentage":91.232,"Year":2021},{"Name":"Tanzania","Iso":"TZA","Borders":["BDI","COD","KEN","MWI","MOZ","RWA","UGA","ZMB"],"Percentage":44.676,"Year":2021},{"Name":"Thailand","Iso":"THA","Borders":["MMR","KHM","LAO","MYS"],"Percentage":14.507,"Year":2021},{"Name":"Timor-Leste","Iso":"TLS","Borders":["IDN"],"Percentage":0,"Year":2021},{"Name":"Togo","Iso":"TGO","Borders":["BEN","BFA","GHA"],"Percentage":26.984,"Year":2021},{"Name":"Tonga","Iso":"TON","Percentage":12.5,"Year":2021},{"Name":"Trinidad and Tobago","Iso":"TTO","Percentage":0.115,"Year":2021},{"Name":"Tunisia","Iso":"TUN","Borders":["DZA","LBY"],"Percentage":4.778,"Year":2021},{"Name":"Turkey","Iso":"TUR","Borders":["ARM","AZE","BGR","GEO","GRC","IRN","IRQ","SYR"],"Percentage":35.33,"Year":2021},{"Name":"Turkmenistan","Iso":"TKM","Borders":["AFG","IRN","KAZ","UZB"],"Percentage":0,"Year":2021},{"Name":"Turks and Caicos Islands","Iso":"TCA","Percentage":0,"Year":2021},{"Name":"Tuvalu","Iso":"TUV","Percentage":0,"Year":2019},{"Name":"Uganda","Iso":"UGA","Borders":["COD","KEN","RWA","SSD","TZA"],"Percentage":97.045,"Year":2021},{"Name":"Ukraine","Iso":"UKR","Borders":["BLR","HUN","MDA","POL","ROU","RUS","SVK"],"Percentage":14.038,"Year":2021},{"Name":"United Arab Emirates","Iso":"ARE","Borders":["OMN","SAU"],"Percentage":4.94,"Year":2021},{"Name":"United Kingdom","Iso":"GBR","Borders":["IRL"],"Percentage":39.784,"Year":2021},{"Name":"United States","Iso":"USA","Borders":["CAN","MEX"],"Percentage":20.75,"Year":2021},{"Name":"United States Virgin Islands","Iso":"VIR","Percentage":2.857,"Year":2021},{"Name":"Uruguay","Iso":"URY","Borders":["ARG","BRA"],"Percentage":78.066,"Year":2021},{"Name":"Uzbekistan","Iso":"UZB","Borders":["AFG","KAZ","KGZ","TJK","TKM"],"Percentage":8.461,"Year":2021},{"Name":"Vanuatu","Iso":"VUT","Percentage":28.571,"Year":2021},{"Name":"Venezuela","Iso":"VEN","Borders":["BRA","COL","GUY"],"Percentage":64.485,"Year":2021},{"Name":"Vietnam","Iso":"VNM","Borders":["KHM","CHN","LAO"],"Percentage":42.579,"Year":2021},{"Name":"Western Sahara","Iso":"ESH","Borders":["DZA","MRT","MAR"],"Percentage":0,"Year":2021},{"Name":"Yemen","Iso":"YEM","Borders":["OMN","SAU"],"Percentage":17.045,"Year":2021},{"Name":"Zambia","Iso":"ZMB","Borders":["AGO","BWA","COD","MWI","MOZ","NAM","TZA","ZWE"],"Percentage":92.208,"Year":2021},{"Name":"Zimbabwe","Iso":"ZWE","Borders":["BWA","MOZ","ZAF","ZMB"],"Percentage":54.975,"Year":2021}]`
	testUrl = "/energy/v1/renewables/current/"
	// Test the /energy/v1/renewables/current/ endpoint it takes the newest data from each country
	if !testHandlerResponse(t, baseURL+testUrl, expected, thisHandler) {
		t.Fail()
	}
}

// TestStatusHandler tests the StatusHandler function
func TestStatusHandler(t *testing.T) {
	// Create a new HTTP request with method "GET" and URL "/status"
	req, err := http.NewRequest("GET", "/status", nil)
	if err != nil {
		t.Fatal(err)
	}

	// Create a new ResponseRecorder to record the response
	rr := httptest.NewRecorder()

	// Create a new http.HandlerFunc using the StatusHandler function
	handler := http.HandlerFunc(handler.StatusHandler)

	// Call the handler function with the request and response recorder
	handler.ServeHTTP(rr, req)

	// Check the response status code
	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v", status, http.StatusOK)
	}

	// Define the expected response body
	expected := `status of restcountries API: 200 OK
Energy data located!
Uptime: \d+ seconds
`

	// Check the response body using a regular expression match
	if match, _ := regexp.MatchString(expected, rr.Body.String()); !match {
		t.Errorf("handler returned unexpected body: got %v want %v", rr.Body.String(), expected)
	}
}
func TestDefaultHandler(t *testing.T) {
	req, err := http.NewRequest("GET", "/", nil)
	if err != nil {
		t.Fatal(err)
	}

	rr := httptest.NewRecorder()
	handler := http.HandlerFunc(handler.DefaultHandler)

	handler.ServeHTTP(rr, req)

	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v", status, http.StatusOK)
	}

	expected := "No functionality for default handler!\n\ntry using one of these:\n"
	expected += helper.CURRENT + "\n"
	expected += helper.HISTORY + "\n"
	expected += helper.NOTIFICATIONS + "\n"
	expected += helper.STATUS + "\n"

	if rr.Body.String() != expected {
		t.Errorf("handler returned unexpected body: got %v want %v", rr.Body.String(), expected)
	}
}

// ============== Webhook Handler (notificationHandler.go) =================================

func TestNotifGetRequestEmpty(t *testing.T) {
	// create a new request
	req := httptest.NewRequest(http.MethodGet, "/energy/v1/notifications", nil)
	// create a new ResponseRecorder
	rr := httptest.NewRecorder()
	// Call the notifGetRequest function with the ResponseRecorder and Request objects
	handler.NotifGetRequest(rr, req)
	// get status code
	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v", status, http.StatusOK)
	}
	// response body test
	expected := "No webhooks\n"
	if rr.Body.String() != expected {
		t.Errorf("handler returned unexpected body: got %v want %v", rr.Body.String(), expected)
	}
}

func TestPostRequest(t *testing.T) {
	// create a mock server
	server := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		// check the HTTP method
		if r.Method != http.MethodPost {
			t.Errorf("expected %s request, but got %s", http.MethodPost, r.Method)
		}
		// send a response with a JSON-encoded body
		response := helper.WebhookRegistration{WebhookID: "webhook123", Url: "https://example.com/webhook", Country: "US", Calls: 0}
		responseBytes, err := json.Marshal(response)
		if err != nil {
			t.Errorf("error encoding response body: %v", err)
		}
		w.WriteHeader(http.StatusOK)
		w.Write(responseBytes)
	}))
	defer server.Close()

	// make a POST request to the mock server
	client := &http.Client{}

	requestBody := []byte(`{"url":"https://example.com/webhook", "country":"NOR"}`)
	req, _ := http.NewRequest("POST", server.URL, bytes.NewBuffer(requestBody))
	res, _ := client.Do(req)

	// Check response status code
	if res.StatusCode != http.StatusOK {
		t.Errorf("Expected status code %d but got %d", http.StatusOK, res.StatusCode)
	}

	// Check response body
	var respBody = helper.WebhookRegistration{}
	err := json.NewDecoder(res.Body).Decode(&respBody)
	if err != nil {
		t.Errorf("Error decoding response body: %v", err)
	}
	expectedRespBody := helper.WebhookRegistration{
		WebhookID: "webhook123",
		Url:       "https://example.com/webhook",
		Country:   "US",
		Calls:     0,
	}
	if !reflect.DeepEqual(expectedRespBody, respBody) {
		t.Errorf("Response body does not match expected body. Expected: %v, but got: %v", expectedRespBody, respBody)
	}

}

func TestNotifDeleteRequest(t *testing.T) {
	// Create a new request with an ID in the URL
	req, err := http.NewRequest("DELETE", "/webhooks/webhook123", nil)
	if err != nil {
		t.Fatal(err)
	}

	// Create a response recorder to record the response
	rr := httptest.NewRecorder()

	// Call the handler function with the request and response recorder
	handler.NotifDeleteRequest(rr, req)

	// Check the response status code
	if status := rr.Code; status != http.StatusOK {
		t.Errorf("handler returned wrong status code: got %v want %v", status, http.StatusOK)
	}

	// Check that the webhook was deleted
	found := false
	for _, w := range handler.Webhooks {
		if w.WebhookID == "webhook123" {
			found = true
			break
		}
	}
	if found {
		t.Errorf("handler did not delete webhook with ID 'webhook123'")
	}
}
func TestNotifCountryCall(t *testing.T) {
	// Create a sample webhook with "US" as the country
	webhook := helper.WebhookRegistration{
		WebhookID: "webhook123",
		Url:       "https://example.com/webhook",
		Country:   "US",
		Calls:     0,
	}

	// Add the webhook to the list of webhooks
	handler.Webhooks = append(handler.Webhooks, webhook)

	// Call NotifCountryCall with "US" as the country and "GET" as the method
	handler.NotifCountryCall("US", "GET")

	// Check that the webhook's calls count has been incremented
	if handler.Webhooks[0].Calls != 1 {
		t.Errorf("Expected webhook calls count to be 1, but got %d", handler.Webhooks[0].Calls)
	}
}
func TestGenID(t *testing.T) {
	handler.Webhooks = []helper.WebhookRegistration{{WebhookID: "TESTID1234"}}
	id1 := handler.GenID()
	if id1 == "TESTID1234" {
		t.Errorf("GenID() returned existing ID: %v", id1)
	}
	id2 := handler.GenID()
	if id1 == id2 {
		t.Errorf("GenID() returned identical IDs: %v and %v", id1, id2)
	}
	handler.Webhooks = append(handler.Webhooks, helper.WebhookRegistration{WebhookID: id2})
	id3 := handler.GenID()
	for _, val := range handler.Webhooks {
		if val.WebhookID == id3 {
			t.Errorf("GenID() returned duplicate ID: %v", id3)
			break
		}
	}
}
